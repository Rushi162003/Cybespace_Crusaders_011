<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./admin.css">
    <title>Admin Dashboard-Edit Product</title>
</head>

<body>
    <nav class="navbar">
        <div class="logo">Nayka Admin</div>
        <div class="toggle">&#9776;</div>
        <ul>
            <li><a href="admin.html">Dashboard</a></li>
            <li><a href="#users">Users</a></li>
            <li><a href="./addProduct.html">Add Product</a></li>
            <li><a href="#settings">Settings</a></li>
            <li>
                <p style="cursor: pointer;" id="logout-button">Logout</p>
            </li>
        </ul>
    </nav>

    <div class="main-content">
        <div class="header">
            <h1>Edit Products</h1>
        </div>
        <form action="" id="addProduct">
            <div class="first-col">
                <div class="input-box">
                    <label for="name">Name</label>
                    <input type="text" id="name" placeholder="Enter product name">
                </div>
                <div class="input-box">
                    <label for="brand">Brand</label>
                    <input type="text" id="brand" placeholder="Enter product brand">
                </div>
                <div class="input-box">
                    <label for="category">Category</label>
                    <select id="category">
                        <option value="">Select category</option>
                        <!-- Add categories as needed -->
                    </select>
                </div>
                <div class="input-box">
                    <label for="price">Price</label>
                    <input type="number" id="price" placeholder="Enter price">
                </div>
                <div class="input-box">
                    <label for="currency">Currency</label>
                    <input type="text" id="currency" placeholder="Enter currency">
                </div>
            </div>
            <div class="sec-col">
                <div class="input-box">
                    <label for="stockStatus">Stock Status</label>
                    <select id="stockStatus">
                        <option value="true">In Stock</option>
                        <option value="false">Out of Stock</option>
                    </select>
                </div>
                <div class="input-box">
                    <label for="rating">Rating</label>
                    <input type="text" id="rating" placeholder="Enter rating">
                </div>
                <div class="input-box">
                    <label for="reviewsCount">Reviews Count</label>
                    <input type="text" id="reviewsCount" placeholder="Enter reviews count">
                </div>
                <div class="input-box">
                    <label for="imageUrl">Image URL</label>
                    <input type="text" id="imageUrl" placeholder="Enter image URL">
                </div>
                <input type="submit" class="btn" value="Add Product">
            </div>
        </form>
    </div>
</body>

</html>

<script>
    let name = document.querySelector("#name")
    let brand = document.querySelector("#brand")
    let category = document.querySelector("#category")
    let price = document.querySelector("#price")
    let currency = document.querySelector("#currency")
    let stockStatus = document.querySelector("#stockStatus")
    let rating = document.querySelector("#rating")
    let reviewsCount = document.querySelector("#reviewsCount")
    let imageUrl = document.querySelector("#imageUrl")
    let param = new URLSearchParams(window.location.search)
    let id = param.get("id")
    console.log(id)


    async function fetchData() {
        try {
            // Ensure 'id' is defined somewhere in your code
            let res = await fetch(`https://nayka-4ffd7-default-rtdb.firebaseio.com/${id}.json`);
            let data = await res.json();

            // Check if data exists and is an object before accessing properties
            if (data) {
                name.value = data.name || '';
                brand.value = data.brand || '';
                category.value = data.category || '';
                price.value = data.price || '';
                currency.value = data.currency || '';
                stockStatus.value = data.stockStatus || '';
                rating.value = data.ratings || '';
                reviewsCount.value = data.reviewsCount || '';
                imageUrl.value = data.imageUrl || '';
                console.log(data);

                let categoryElement = document.querySelector("#category");
                categoryElement.innerHTML = ""; // Optional: clear existing options

                let uniqueCategories = new Set();

                // Check if data is an array
                if (Array.isArray(data)) {
                    data.forEach(element => {
                        if (element.category && !uniqueCategories.has(element.category)) {
                            uniqueCategories.add(element.category);
                            let option = document.createElement("option");
                            option.value = element.category;
                            option.textContent = element.category;
                            categoryElement.appendChild(option);
                        }
                    });
                } else {
                    console.error("Response is not an array:", data);
                }
            } else {
                console.error("No data received or data is null:", data);
            }
        } catch (error) {
            alert("Failed to fetch product data");
            console.log(error);
        }
    }

    fetchData();

    let form = document.querySelector("#addProduct")


    form.addEventListener("submit", getProduct)

    function getProduct() {
        event.preventDefault()

        let name = document.querySelector("#name")
        let brand = document.querySelector("#brand")
        let category = document.querySelector("#category")
        let price = document.querySelector("#price")
        let currency = document.querySelector("#currency")
        let stockStatus = document.querySelector("#stockStatus")
        let rating = document.querySelector("#rating")
        let reviewsCount = document.querySelector("#reviewsCount")
        let imageUrl = document.querySelector("#imageUrl")

        let proObj = {
            name: name,
            brand: brand,
            category: category,
            price: price,
            currency: currency,
            stockStatus: stockStatus,
            ratings: rating,
            reviewsCount: reviewsCount,
            imageUrl: imageUrl
        }
        addProduct(proObj)
    }

    async function addProduct(proObj) {
        var headers = new Headers()
        headers.append("Content-Type", "application/json")
        // Ganerate Random id

        let request = {
            method: "PATCH",
            headers: headers,
            body: JSON.stringify(proObj),
            redirect: "follow"
        }

        try {
            let res = await fetch(`https://nayka-4ffd7-default-rtdb.firebaseio.com/${id}.json`)
            let data = await res.json()

            name.value = data.name
            brand.value = data.brand
            category.value = data.category
            price.value = data.price
            currency.value = data.currency
            stockStatus.value = data.stockStatus
            rating.value = data.ratings
            reviewsCount.value = data.reviewsCount
            imageUrl.value = data.imageUrl
            console.log(data)
        }
        catch (error) {
            alert("Product was not added")
            console.log(error)
        }
    }

</script>